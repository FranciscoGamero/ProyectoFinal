<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Página Principal</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="../static/css/estilo.css" th:href="@{/css/estilo.css}">
</head>
	<body class="d-flex flex-column justify-content-between min-vh-100">
		<header th:replace="~{fragmentos/encabezado::encabezado}"></header>
		<div sec:authorize="hasRole('ROLE_USER') or hasRole('ROLE_ADMIN')">
			<nav th:replace="~{fragmentos/navUsuario::navUsuario}"></nav>
		</div>
		<div sec:authorize="!isAuthenticated()">
			<nav th:replace="~{fragmentos/navSinRegistrar::navSinRegistrar}"></nav>
		</div>
		<main class="container-fluid py-5">
			<form method="POST" th:action="@{/realizarReserva/submit}" th:object="${reserva}">
				<div class="container text-white fw-bolder">
					<div class="row d-flex justify-content-center align-items-center h-100">
						<div class="col">
							<div class="card card-registration my-4">
								<div class="row g-0">
									<div class="card-body p-md-5 text-black">
										<h3 class="mb-5 text-uppercase text-center">Realizar Reserva</h3>
										<div class="row">
											<div class="col-6 mb-4">
												<p class="oculto error" id="errorFechaInicio">La fecha y hora de inicio no pueden ser anteriores a la fecha y hora actual.</p>
												<label for="fechaInicioReserva" class="form-label">Fecha y Hora de
													Inicio de la Reserva:
													<span class="text-danger">*</span> </label>
												<input type="datetime-local" name="fechaInicioReserva"
													id="fechaInicioReserva" th:field="*{fechaInicioReserva}"
													class="form-control" required>
											</div>
											<div class="col-6 mb-4">
												<p class="oculto error" id="errorFechaFinal">La fecha y hora de fin deben ser posteriores a la fecha y hora de inicio.</p>
												<label for="fechaFinReserva" class="form-label">Fecha y Hora de Fin de
													la Reserva:
													<span class="text-danger">*</span> </label>
												<input type="datetime-local" name="fechaFinReserva" id="fechaFinReserva"
													th:field="*{fechaFinReserva}" class="form-control" required>
											</div>
											<div class="form-outline mb-4">
												<label for="galeriaDescripcion" class="form-label">Galería:</label>
												<input type="text" id="galeriaDescripcion" name="galeriaDescripcion"
													th:value="${galeria.descripcion}" class="form-control" readonly>
												<input type="hidden" id="galeriaId" name="galeriaId"
													th:value="${galeria.id}">
											</div>
											<div class="form-outline mb-4">
												<input type="submit" class="btn btn-warning btn-lg ms-2"
													value="Reservar">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</main>
		
		<footer th:replace="~{fragmentos/footer::footer}"></footer>
			<script>
				function conseguirHora(fecha) {
					fecha.setMinutes(0, 0, 0);
					return fecha;
				}
		
				function handlefechaTimeInput(event) {
					let fecha = new fecha(event.target.value);
					if (fecha.getMinutes() !== 0 || fecha.getSeconds() !== 0 || fecha.getMilliseconds() !== 0) {
						fecha = roundToHour(fecha);
						event.target.value = fecha.toISOString().slice(0, 16);
					}
				}
		
				function valifechafechas(event) {
					let ahora = new fecha();
					let fechaInicioInput = document.getElementById('fechaInicioReserva');
					let endfechaInput = document.getElementById('fechaFinReserva');
					let fechaInicio = new fecha(fechaInicioInput.value);
					let endfecha = new fecha(endfechaInput.value);
		
					let mensajeFechaInicio = document.getElementById('errorFechaInicio')
					let mensajeFechaFinal = document.getElementById('errorFechaFinal')

					if (fechaInicio < ahora) {
						alert("La fecha y hora de inicio no pueden ser anteriores a la fecha y hora actual.");
						mensajeFechaInicio.classList.remove('oculto');
						event.preventDefault();
					} else if (endfecha <= fechaInicio) {
						alert("La fecha y hora de fin deben ser posteriores a la fecha y hora de inicio.");
						mensajeFechaFinal.classList.remove('oculto');
						event.preventDefault();
					}
				}
		
				function init() {
					let fechaTimeInputs = document.querySelectorAll('input[type="fechatime-local"]');
		
					fechaTimeInputs.forEach(function(input) {
						input.addEventListener('input', handlefechaTimeInput);
					});
		
					let form = document.querySelector('form');
					form.addEventListener('submit', valifechafechas);
				}
		
				document.addEventListener('DOMContentLoaded', init);
			</script>
	</body>
</html>